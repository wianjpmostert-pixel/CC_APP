<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SA NGO Tax Relief Platform</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-heart"></i> SA NGO Platform
            </div>
            <div class="nav-menu">
                <a href="#home" class="nav-link active">Home</a>
                <a href="#donate" class="nav-link">Donate</a>
                <a href="#dashboard" class="nav-link">Dashboard</a>
                <a href="#apply" class="nav-link">Apply</a>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle" id="account-dropdown">
                        <span id="user-name">Account</span> <i class="fas fa-chevron-down"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div id="logged-out-menu">
                            <a href="login.html" class="dropdown-item">Login</a>
                            <a href="register.html" class="dropdown-item">Register</a>
                        </div>
                        <div id="logged-in-menu" style="display: none;">
                            <a href="#profile" class="dropdown-item">My Profile</a>
                            <a href="#" class="dropdown-item" onclick="logout()">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Home Section -->
    <div id="home" class="page active">
    <header>
        <div class="hero-content">
            <h1><i class="fas fa-heart"></i> South African NGO Tax Relief Platform</h1>
            <p>Helping South Africans make a difference and save on taxes by donating to verified NGOs. SARS approved donations with maximum tax benefits.</p>
            <div class="hero-stats">
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span class="stat-number">8,500+</span>
                    <span class="stat-label">SA Donors Helped</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-dollar-sign"></i>
                    <span class="stat-number">R18.7M</span>
                    <span class="stat-label">Tax Savings</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-shield-check"></i>
                    <span class="stat-number">250+</span>
                    <span class="stat-label">Verified NGOs</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Tax Calculator Section -->
    <section id="tax-calculator">
        <h2><i class="fas fa-calculator"></i> SA Tax Savings Calculator</h2>
        <p>See how much you can save on taxes while helping South Africans in need! Based on current SARS tax tables.</p>
        <div class="calculator-container">
            <div class="input-group">
                <label for="income">Annual Taxable Income (R)</label>
                <input type="number" id="income" placeholder="500000" oninput="calculateSavings()">
            </div>
            <div class="input-group">
                <label for="donation">Donation Amount (R)</label>
                <input type="number" id="donation" placeholder="10000" oninput="calculateSavings()">
            </div>
            <div class="results">
                <div class="result-item">
                    <span class="result-label">Your Tax Rate:</span>
                    <span id="tax-bracket">31%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Maximum Deductible:</span>
                    <span id="max-deductible">R10,000</span>
                </div>
                <div class="result-item savings">
                    <span class="result-label">Your Tax Savings:</span>
                    <span id="tax-savings">R3,100</span>
                </div>
                <div class="result-item impact">
                    <span class="result-label">Net Cost to You:</span>
                    <span id="net-cost">R6,900</span>
                </div>
            </div>
            <div class="tax-info">
                <p><strong>SARS Guidelines:</strong> You can deduct up to 10% of your taxable income (max R100,000) for donations to SARS-approved Section 18A organizations.</p>
            </div>
        </div>
    </section>

    <section id="tax-benefits">
        <h2><i class="fas fa-chart-line"></i> Why Choose Our Verified NGOs</h2>
        <p>
            We ensure every Rand donated makes a real impact. Our rigorous verification process guarantees your donations go to legitimate, SARS-approved Section 18A organizations, maximizing both your tax benefits and social impact across South Africa.
        </p>
        
        <div class="benefits-grid">
            <div class="benefit-card">
                <i class="fas fa-search-plus"></i>
                <h3>Rigorous NGO Verification</h3>
                <p>We conduct quarterly audits, site visits, and impact assessments to ensure every NGO meets our strict standards for transparency and effectiveness.</p>
            </div>
            <div class="benefit-card">
                <i class="fas fa-certificate"></i>
                <h3>SARS Section 18A Approved</h3>
                <p>All NGOs are verified Section 18A organizations, ensuring maximum tax deductions up to 10% of your taxable income (max R100,000 annually).</p>
            </div>
            <div class="benefit-card">
                <i class="fas fa-chart-bar"></i>
                <h3>Impact Tracking & Reports</h3>
                <p>Receive detailed quarterly reports showing exactly how your donations are being used, with photos and stories from beneficiaries.</p>
            </div>
            <div class="benefit-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Fraud Protection</h3>
                <p>Our verification team includes former SARS auditors and NGO sector experts who ensure your money reaches those who need it most.</p>
            </div>
            <div class="benefit-card">
                <i class="fas fa-receipt"></i>
                <h3>Instant Tax Certificates</h3>
                <p>Receive your Section 18A tax certificate immediately via email, ready for your SARS eFiling submission.</p>
            </div>
            <div class="benefit-card">
                <i class="fas fa-map-marked-alt"></i>
                <h3>Local Focus</h3>
                <p>Support communities across all 9 provinces of South Africa, from rural Eastern Cape to urban Gauteng townships.</p>
            </div>
        </div>
    </section>

    <!-- NGO Selection Section -->
    <section id="ngo-selection">
        <h2><i class="fas fa-list"></i> Choose Your NGO to Support</h2>
        <p>Select from our verified South African NGOs, all SARS Section 18A approved for maximum tax benefits.</p>
        
        <div class="ngo-selector">
            <div class="filter-tabs">
                <button class="filter-btn active" data-category="all">All NGOs</button>
                <button class="filter-btn" data-category="education">Education</button>
                <button class="filter-btn" data-category="healthcare">Healthcare</button>
                <button class="filter-btn" data-category="water">Water & Sanitation</button>
                <button class="filter-btn" data-category="poverty">Poverty Relief</button>
                <button class="filter-btn" data-category="environment">Environment</button>
            </div>
            
            <div class="ngo-grid">
                <div class="ngo-item" data-category="education">
                    <div class="ngo-logo">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3>Teach South Africa</h3>
                    <p>Recruiting and developing exceptional graduates to teach in township schools.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> National</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('Teach South Africa', 'education')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="healthcare">
                    <div class="ngo-logo">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <h3>Gift of the Givers</h3>
                    <p>Africa's largest disaster relief organization providing humanitarian aid and medical support.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> National</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('Gift of the Givers', 'healthcare')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="water">
                    <div class="ngo-logo">
                        <i class="fas fa-tint"></i>
                    </div>
                    <h3>Water For People</h3>
                    <p>Building sustainable water and sanitation solutions in rural South African communities.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> Rural Areas</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('Water For People', 'water')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="poverty">
                    <div class="ngo-logo">
                        <i class="fas fa-hands-helping"></i>
                    </div>
                    <h3>Nelson Mandela Foundation</h3>
                    <p>Promoting social justice and fighting poverty through community development programs.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> Gauteng</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('Nelson Mandela Foundation', 'poverty')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="education">
                    <div class="ngo-logo">
                        <i class="fas fa-book-reader"></i>
                    </div>
                    <h3>READ Educational Trust</h3>
                    <p>Improving literacy and numeracy in underprivileged South African schools.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> Western Cape</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('READ Educational Trust', 'education')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="environment">
                    <div class="ngo-logo">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h3>WWF South Africa</h3>
                    <p>Conservation and environmental protection across South Africa's diverse ecosystems.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> National</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('WWF South Africa', 'environment')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="healthcare">
                    <div class="ngo-logo">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <h3>Desmond Tutu Health Foundation</h3>
                    <p>Research and care for HIV/AIDS and tuberculosis in South African communities.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> Western Cape</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('Desmond Tutu Health Foundation', 'healthcare')">Donate Now</button>
                </div>

                <div class="ngo-item" data-category="poverty">
                    <div class="ngo-logo">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3>Habitat for Humanity SA</h3>
                    <p>Building affordable housing solutions for low-income South African families.</p>
                    <div class="ngo-details">
                        <span class="location"><i class="fas fa-map-marker-alt"></i> National</span>
                        <span class="verified"><i class="fas fa-certificate"></i> SARS Verified</span>
                    </div>
                    <button class="donate-btn" onclick="selectNGO('Habitat for Humanity SA', 'poverty')">Donate Now</button>
                </div>
            </div>
        </div>
    </section>
                </div>
            </div>
        </div>
    </section>

    </div> <!-- End Home Section -->

    <!-- Donate Section -->
    <div id="donate" class="page">
        <section class="donation-form-section">
            <h2><i class="fas fa-donate"></i> Make Your Tax-Deductible Donation</h2>
            <div class="donation-container">
                <div class="donation-form">
                    <h3>Selected NGO: <span id="selected-ngo">Choose an NGO</span></h3>
                    <form id="donation-form">
                        <div class="form-group">
                            <label for="donor-name">Full Name</label>
                            <input type="text" id="donor-name" required>
                        </div>
                        <div class="form-group">
                            <label for="donor-email">Email Address</label>
                            <input type="email" id="donor-email" required>
                        </div>
                        <div class="form-group">
                            <label for="donor-phone">Phone Number</label>
                            <input type="tel" id="donor-phone" required>
                        </div>
                        <div class="form-group">
                            <label for="donation-amount">Donation Amount (R)</label>
                            <input type="number" id="donation-amount" min="50" step="50" value="1000" required>
                        </div>
                        <div class="form-group">
                            <label for="donation-frequency">Frequency</label>
                            <select id="donation-frequency">
                                <option value="once">One-time Donation</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annually">Annually</option>
                            </select>
                        </div>
                        <div class="tax-preview">
                            <h4>Tax Benefit Preview:</h4>
                            <p>Donation: <span id="preview-amount">R1,000</span></p>
                            <p>Tax Savings: <span id="preview-savings">R310</span></p>
                            <p>Net Cost: <span id="preview-net">R690</span></p>
                        </div>
                        <button type="submit" class="donate-submit-btn">Donate Now & Get Certificate</button>
                    </form>
                </div>
                <div class="payment-methods">
                    <h3>Secure Payment Options</h3>
                    <div class="payment-icons">
                        <i class="fab fa-cc-visa"></i>
                        <i class="fab fa-cc-mastercard"></i>
                        <i class="fas fa-university"></i>
                        <span>EFT</span>
                    </div>
                    <div class="security-badges">
                        <p><i class="fas fa-lock"></i> 256-bit SSL Encrypted</p>
                        <p><i class="fas fa-shield-alt"></i> SARS Compliant</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard" class="page">
        <!-- Login Required Message -->
        <section id="login-required" class="dashboard-section">
            <div class="login-required-content">
                <i class="fas fa-lock fa-3x"></i>
                <h2>Login Required</h2>
                <p>Please login to access your donation dashboard and view your tax certificates.</p>
                <a href="login.html" class="auth-btn">Login Now</a>
                <p class="auth-switch">Don't have an account? <a href="register.html">Create one here</a></p>
            </div>
        </section>

        <!-- Actual Dashboard (Hidden until login) -->
        <section id="user-dashboard" class="dashboard-section" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> Your Donation Dashboard</h2>
            <div class="user-welcome">
                <h3>Welcome back, <span id="dashboard-user-name">User</span>!</h3>
                <p>Here's your donation summary and tax savings for the current year.</p>
            </div>
            <div class="dashboard-container">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <i class="fas fa-donate"></i>
                        <h3>Total Donated</h3>
                        <p class="stat-value" id="total-donated">R0</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calculator"></i>
                        <h3>Tax Savings</h3>
                        <p class="stat-value" id="total-tax-savings">R0</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-heart"></i>
                        <h3>NGOs Supported</h3>
                        <p class="stat-value" id="ngos-supported">0</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-file-alt"></i>
                        <h3>Certificates</h3>
                        <p class="stat-value" id="total-certificates">0</p>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="donation-history">
                        <h3>Recent Donations</h3>
                        <div id="donations-table">
                            <div class="no-donations">
                                <i class="fas fa-heart"></i>
                                <p>No donations yet. <a href="#donate" onclick="showPage('donate')">Make your first donation</a> to start saving on taxes!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="yearly-summary">
                        <h3>2025 Tax Year Summary</h3>
                        <div class="summary-card">
                            <p>Total Donations: <strong id="summary-total">R0</strong></p>
                            <p>Total Tax Savings: <strong id="summary-savings">R0</strong></p>
                            <p>Effective Cost: <strong id="summary-cost">R0</strong></p>
                            <button class="download-btn large" onclick="downloadAnnualSummary()">
                                <i class="fas fa-file-pdf"></i> Download Annual Summary
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Apply Section -->
    <div id="apply" class="page">
        <section class="apply-section">
            <h2><i class="fas fa-user-plus"></i> Join Our Platform</h2>
            <div class="apply-tabs">
                <button class="apply-tab-btn active" data-tab="donor">Apply as Donor</button>
                <button class="apply-tab-btn" data-tab="receiver">Apply as NGO</button>
            </div>
            
            <!-- Donor Application -->
            <div id="donor-application" class="apply-content active">
                <h3>Become a Verified Donor</h3>
                <p>Join thousands of South Africans making a difference while saving on taxes.</p>
                <form class="application-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="donor-first-name">First Name</label>
                            <input type="text" id="donor-first-name" required>
                        </div>
                        <div class="form-group">
                            <label for="donor-last-name">Last Name</label>
                            <input type="text" id="donor-last-name" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="donor-email-apply">Email Address</label>
                            <input type="email" id="donor-email-apply" required>
                        </div>
                        <div class="form-group">
                            <label for="donor-phone-apply">Phone Number</label>
                            <input type="tel" id="donor-phone-apply" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="donor-id">SA ID Number</label>
                        <input type="text" id="donor-id" pattern="[0-9]{13}" required>
                    </div>
                    <div class="form-group">
                        <label for="donor-address">Physical Address</label>
                        <textarea id="donor-address" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="annual-income">Estimated Annual Income Range</label>
                        <select id="annual-income" required>
                            <option value="">Select Income Range</option>
                            <option value="0-200000">R0 - R200,000</option>
                            <option value="200000-500000">R200,000 - R500,000</option>
                            <option value="500000-1000000">R500,000 - R1,000,000</option>
                            <option value="1000000+">R1,000,000+</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="terms-donor" required>
                        <label for="terms-donor">I agree to the Terms & Conditions and Privacy Policy</label>
                    </div>
                    <button type="submit" class="apply-submit-btn">Submit Donor Application</button>
                </form>
            </div>
            
            <!-- NGO Application -->
            <div id="ngo-application" class="apply-content">
                <h3>Register Your NGO</h3>
                <p>Get verified and start receiving tax-deductible donations from our platform.</p>
                <form class="application-form" id="ngo-application-form">
                    <div class="form-section">
                        <h4>Organization Details</h4>
                        <div class="form-group">
                            <label for="ngo-name">Organization Name *</label>
                            <input type="text" id="ngo-name" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ngo-registration">NPO Registration Number *</label>
                                <input type="text" id="ngo-registration" pattern="[0-9]{3}-[0-9]{3}" placeholder="123-456" required>
                            </div>
                            <div class="form-group">
                                <label for="section18a-number">Section 18A Number *</label>
                                <input type="text" id="section18a-number" placeholder="18A/11/13/1234" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ngo-founded">Year Founded *</label>
                                <input type="number" id="ngo-founded" min="1900" max="2025" required>
                            </div>
                            <div class="form-group">
                                <label for="ngo-category">Primary Focus Area *</label>
                                <select id="ngo-category" required>
                                    <option value="">Select Category</option>
                                    <option value="education">Education & Skills Development</option>
                                    <option value="healthcare">Healthcare & Medical Aid</option>
                                    <option value="poverty">Poverty Relief & Social Development</option>
                                    <option value="environment">Environment & Conservation</option>
                                    <option value="water">Water & Sanitation</option>
                                    <option value="housing">Housing & Shelter</option>
                                    <option value="children">Children & Youth Development</option>
                                    <option value="elderly">Elderly Care</option>
                                    <option value="disability">Disability Support</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ngo-description">Organization Description & Mission Statement *</label>
                            <textarea id="ngo-description" rows="4" placeholder="Describe your organization's mission, vision, and primary activities..." required></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Impact & Operations</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="beneficiaries-served">Number of Beneficiaries Served Annually *</label>
                                <select id="beneficiaries-served" required>
                                    <option value="">Select Range</option>
                                    <option value="1-100">1 - 100 people</option>
                                    <option value="101-500">101 - 500 people</option>
                                    <option value="501-1000">501 - 1,000 people</option>
                                    <option value="1001-5000">1,001 - 5,000 people</option>
                                    <option value="5000+">5,000+ people</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="annual-budget">Annual Operating Budget *</label>
                                <select id="annual-budget" required>
                                    <option value="">Select Range</option>
                                    <option value="0-100000">R0 - R100,000</option>
                                    <option value="100000-500000">R100,000 - R500,000</option>
                                    <option value="500000-1000000">R500,000 - R1,000,000</option>
                                    <option value="1000000-5000000">R1,000,000 - R5,000,000</option>
                                    <option value="5000000+">R5,000,000+</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="provinces-operating">Provinces Where You Operate *</label>
                            <div class="checkbox-group-provinces">
                                <label><input type="checkbox" name="provinces" value="gauteng"> Gauteng</label>
                                <label><input type="checkbox" name="provinces" value="western-cape"> Western Cape</label>
                                <label><input type="checkbox" name="provinces" value="kwazulu-natal"> KwaZulu-Natal</label>
                                <label><input type="checkbox" name="provinces" value="eastern-cape"> Eastern Cape</label>
                                <label><input type="checkbox" name="provinces" value="limpopo"> Limpopo</label>
                                <label><input type="checkbox" name="provinces" value="mpumalanga"> Mpumalanga</label>
                                <label><input type="checkbox" name="provinces" value="north-west"> North West</label>
                                <label><input type="checkbox" name="provinces" value="northern-cape"> Northern Cape</label>
                                <label><input type="checkbox" name="provinces" value="free-state"> Free State</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="impact-measurement">How do you measure and report impact? *</label>
                            <textarea id="impact-measurement" rows="3" placeholder="Describe your impact measurement methods, reporting frequency, and key metrics..." required></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Contact Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contact-person">Primary Contact Person *</label>
                                <input type="text" id="contact-person" required>
                            </div>
                            <div class="form-group">
                                <label for="contact-title">Title/Position *</label>
                                <input type="text" id="contact-title" placeholder="CEO, Director, etc." required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contact-email">Contact Email *</label>
                                <input type="email" id="contact-email" required>
                            </div>
                            <div class="form-group">
                                <label for="contact-phone">Contact Phone *</label>
                                <input type="tel" id="contact-phone" pattern="[0-9+\s\-\(\)]+" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ngo-address">Physical Address *</label>
                            <textarea id="ngo-address" rows="3" placeholder="Full physical address including postal code" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="website-url">Website URL (Optional)</label>
                            <input type="url" id="website-url" placeholder="https://www.yourorganization.org">
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Financial Information</h4>
                        <div class="form-group">
                            <label for="bank-details">Banking Details *</label>
                            <textarea id="bank-details" rows="4" placeholder="Bank name:&#10;Account holder:&#10;Account number:&#10;Branch code:&#10;Account type:" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="funding-sources">Primary Funding Sources *</label>
                            <div class="checkbox-group-funding">
                                <label><input type="checkbox" name="funding" value="individual-donations"> Individual Donations</label>
                                <label><input type="checkbox" name="funding" value="corporate-sponsorship"> Corporate Sponsorship</label>
                                <label><input type="checkbox" name="funding" value="government-grants"> Government Grants</label>
                                <label><input type="checkbox" name="funding" value="international-funding"> International Funding</label>
                                <label><input type="checkbox" name="funding" value="fundraising-events"> Fundraising Events</label>
                                <label><input type="checkbox" name="funding" value="other"> Other</label>
                            </div>
                        </div>
                    </div>

                    <div class="file-upload">
                        <label>Required Documents *:</label>
                        <div class="file-group">
                            <label for="npo-certificate">NPO Registration Certificate</label>
                            <input type="file" id="npo-certificate" accept=".pdf,.jpg,.png" required>
                        </div>
                        <div class="file-group">
                            <label for="section18a-certificate">Section 18A Certificate</label>
                            <input type="file" id="section18a-certificate" accept=".pdf,.jpg,.png" required>
                        </div>
                        <div class="file-group">
                            <label for="financial-statements">Latest Audited Financial Statements</label>
                            <input type="file" id="financial-statements" accept=".pdf" required>
                        </div>
                        <div class="file-group">
                            <label for="constitution">Organization Constitution/Memorandum</label>
                            <input type="file" id="constitution" accept=".pdf" required>
                        </div>
                        <div class="file-group">
                            <label for="board-resolution">Board Resolution Authorizing Application</label>
                            <input type="file" id="board-resolution" accept=".pdf" required>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>Verification & Compliance</h4>
                        <div class="checkbox-group">
                            <input type="checkbox" id="compliance-confirm" required>
                            <label for="compliance-confirm">I confirm that our organization is compliant with all SARS requirements and maintains proper financial records *</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="audit-agreement" required>
                            <label for="audit-agreement">I agree to quarterly financial audits and impact assessments by the platform's verification team *</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="reporting-agreement" required>
                            <label for="reporting-agreement">I agree to provide quarterly impact reports and donor updates *</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="terms-ngo" required>
                            <label for="terms-ngo">I agree to the Terms & Conditions, Privacy Policy, and platform fee structure *</label>
                        </div>
                    </div>
                    <button type="submit" class="apply-submit-btn">Submit NGO Application</button>
                </form>
            </div>
        </section>
    </div>

    <!-- Impact Visualization -->
    <section id="impact-visual">
        <h2><i class="fas fa-chart-pie"></i> Your Donation Impact in South Africa</h2>
        <div class="impact-container">
            <div class="donation-breakdown">
                <h3>Where Your R10,000 Donation Goes:</h3>
                <div class="breakdown-item">
                    <div class="breakdown-bar education" style="width: 45%;"></div>
                    <span>Township Education (45%) - R4,500</span>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-bar water" style="width: 30%;"></div>
                    <span>Rural Water Access (30%) - R3,000</span>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-bar healthcare" style="width: 20%;"></div>
                    <span>Primary Healthcare (20%) - R2,000</span>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-bar admin" style="width: 5%;"></div>
                    <span>Admin & Verification (5%) - R500</span>
                </div>
                <div class="verification-note">
                    <i class="fas fa-shield-check"></i>
                    <span>Every NGO undergoes monthly financial audits</span>
                </div>
            </div>
            <div class="impact-numbers">
                <div class="impact-stat">
                    <i class="fas fa-child"></i>
                    <strong>18 learners</strong>
                    <span>receive quality education for 3 months</span>
                </div>
                <div class="impact-stat">
                    <i class="fas fa-home"></i>
                    <strong>120 families</strong>
                    <span>get access to clean water</span>
                </div>
                <div class="impact-stat">
                    <i class="fas fa-stethoscope"></i>
                    <strong>200 people</strong>
                    <span>receive primary healthcare</span>
                </div>
                <div class="tax-benefit-highlight">
                    <i class="fas fa-calculator"></i>
                    <strong>Save R3,100 on taxes</strong>
                    <span>Your net contribution: only R6,900</span>
                </div>
            </div>
        </div>
    </section>

    <section id="contact">
        <h2>Contact Us</h2>
        <form action="mailto:your.email@example.com" method="POST" enctype="text/plain">
            <label for="name">Name:</label><br>
            <input type="text" id="name" name="name" required><br><br>

            <label for="email">Email:</label><br>
            <input type="email" id="email" name="email" required><br><br>

            <label for="message">Message:</label><br>
            <textarea id="message" name="message" rows="4" required></textarea><br><br>

            <button type="submit">Send</button>
        </form>
        <p>Or email us directly: <a href="mailto:your.email@example.com">your.email@example.com</a></p>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3><i class="fas fa-heart"></i> Make a Difference Today</h3>
                <p>Every donation counts. Start saving on taxes while changing lives.</p>
            </div>
            <div class="footer-section">
                <h3><i class="fas fa-phone"></i> Contact</h3>
                <p>Email: <a href="mailto:wianjpmostert@gmail.com">wianjpmostert@gmail.com</a></p>
                <p>Phone: +27 11 123 4567</p>
            </div>
            <div class="footer-section">
                <h3><i class="fas fa-share-alt"></i> Follow Us</h3>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 SA NGO Tax Relief Platform | Making giving rewarding</p>
        </div>
    </footer>

    <script>
        // Global variables
        let selectedNGO = '';
        let selectedCategory = '';
        let currentUser = null;

        // Authentication functions (removed modal functions)
        function logout() {
            currentUser = null;
            localStorage.removeItem('ngo_platform_current_user');
            updateUIForLoggedOutUser();
            showPage('home');
            alert('You have been logged out successfully.');
        }

        // File-based Data Storage Functions
        async function loadUserData() {
            try {
                const response = await fetch('./users.json');
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.log('Creating new user data file...');
            }
            
            return {
                users: {},
                donations: {},
                metadata: {
                    created: new Date().toISOString(),
                    version: "1.0",
                    totalUsers: 0,
                    totalDonations: 0
                }
            };
        }

        async function saveUserData(data) {
            localStorage.setItem('ngo_platform_data', JSON.stringify(data));
        }

        function downloadUserData() {
            const data = localStorage.getItem('ngo_platform_data');
            if (data) {
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'users.json';
                link.click();
                URL.revokeObjectURL(url);
                
                alert('User data downloaded as users.json\n\nTo persist data, replace the users.json file in your project folder with the downloaded file.');
            }
        }

        function saveUser(userData) {
            localStorage.setItem('ngo_platform_current_user', JSON.stringify(userData));
        }

        function getUser() {
            const userData = localStorage.getItem('ngo_platform_current_user');
            return userData ? JSON.parse(userData) : null;
        }

        async function getAllUsers() {
            const data = localStorage.getItem('ngo_platform_data');
            if (data) {
                return JSON.parse(data);
            }
            return await loadUserData();
        }

        async function saveAllUsers(userData) {
            await saveUserData(userData);
        }

        function getUserDonations() {
            if (!currentUser) return [];
            const data = localStorage.getItem('ngo_platform_data');
            if (data) {
                const parsed = JSON.parse(data);
                return parsed.donations[currentUser.email] || [];
            }
            return [];
        }

        async function saveUserDonations(donations) {
            if (!currentUser) return;
            
            const allData = await getAllUsers();
            if (!allData.donations) allData.donations = {};
            allData.donations[currentUser.email] = donations;
            allData.metadata.totalDonations = Object.values(allData.donations).flat().length;
            
            await saveAllUsers(allData);
        }
        async function loadUserData() {
            try {
                const response = await fetch('./users.json');
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.log('Creating new user data file...');
            }
            
            // Return default structure if file doesn't exist
            return {
                users: {},
                donations: {},
                metadata: {
                    created: new Date().toISOString(),
                    version: "1.0",
                    totalUsers: 0,
                    totalDonations: 0
                }
            };
        }

        async function saveUserData(data) {
            // Since we can't write files directly from the browser, we'll use localStorage as a fallback
            // and provide download functionality for the JSON data
            localStorage.setItem('ngo_platform_data', JSON.stringify(data));
            
            // Also provide a way to download the updated JSON
            console.log('User data saved to localStorage. Use downloadUserData() to get the JSON file.');
        }

        function downloadUserData() {
            const data = localStorage.getItem('ngo_platform_data');
            if (data) {
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'users.json';
                link.click();
                URL.revokeObjectURL(url);
                
                alert('User data downloaded as users.json\n\nTo persist data, replace the users.json file in your project folder with the downloaded file.');
            }
        }

        function saveUser(userData) {
            localStorage.setItem('ngo_platform_current_user', JSON.stringify(userData));
        }

        function getUser() {
            const userData = localStorage.getItem('ngo_platform_current_user');
            return userData ? JSON.parse(userData) : null;
        }

        async function getAllUsers() {
            const data = localStorage.getItem('ngo_platform_data');
            if (data) {
                return JSON.parse(data);
            }
            return await loadUserData();
        }

        async function saveAllUsers(userData) {
            await saveUserData(userData);
        }

        function getUserDonations() {
            if (!currentUser) return [];
            const data = localStorage.getItem('ngo_platform_data');
            if (data) {
                const parsed = JSON.parse(data);
                return parsed.donations[currentUser.email] || [];
            }
            return [];
        }

        async function saveUserDonations(donations) {
            if (!currentUser) return;
            
            const allData = await getAllUsers();
            if (!allData.donations) allData.donations = {};
            allData.donations[currentUser.email] = donations;
            allData.metadata.totalDonations = Object.values(allData.donations).flat().length;
            
            await saveAllUsers(allData);
        }

        // Authentication handlers
        async function login(event) {
            event.preventDefault();
            console.log('Login function called');
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            console.log('Login attempt for email:', email);

            // Check if user exists in JSON data
            const allData = await getAllUsers();
            
            if (allData.users[email] && allData.users[email].password === password) {
                currentUser = allData.users[email];
                saveUser(currentUser);
                updateUIForLoggedInUser();
                closeAuthModal();
                alert('Welcome back! You have successfully logged in.');
            } else {
                alert('Invalid email or password. Please try again.');
            }
            
            return false; // Prevent form submission
        }

        async function register(event) {
            event.preventDefault();
            console.log('Register function called');
            
            const firstName = document.getElementById('reg-first-name').value;
            const lastName = document.getElementById('reg-last-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const phone = document.getElementById('reg-phone').value;
            const idNumber = document.getElementById('reg-id-number').value;
            const annualIncome = document.getElementById('reg-annual-income').value;

            console.log('Registration attempt for email:', email);

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return false;
            }

            // Check if user already exists
            const allData = await getAllUsers();
            
            if (allData.users[email]) {
                alert('User with this email already exists!');
                return false;
            }

            // Create new user
            const newUser = {
                firstName,
                lastName,
                email,
                password,
                phone,
                idNumber,
                annualIncome,
                registrationDate: new Date().toISOString(),
                totalDonated: 0,
                totalTaxSavings: 0
            };

            // Save to users data
            allData.users[email] = newUser;
            allData.metadata.totalUsers = Object.keys(allData.users).length;
            allData.metadata.lastUpdated = new Date().toISOString();
            
            await saveAllUsers(allData);

            // Set as current user
            currentUser = newUser;
            saveUser(currentUser);
            updateUIForLoggedInUser();
            closeAuthModal();
            alert('Account created successfully! Welcome to the platform.\n\nNote: Use downloadUserData() in browser console to backup your data to users.json file.');
            
            return false; // Prevent form submission
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('ngo_platform_current_user');
            updateUIForLoggedOutUser();
            showPage('home');
            alert('You have been logged out successfully.');
        }

        // UI Update Functions
        function updateUIForLoggedInUser() {
            document.getElementById('user-name').textContent = currentUser.firstName;
            document.getElementById('logged-out-menu').style.display = 'none';
            document.getElementById('logged-in-menu').style.display = 'block';
            
            // Update dashboard
            document.getElementById('login-required').style.display = 'none';
            document.getElementById('user-dashboard').style.display = 'block';
            document.getElementById('dashboard-user-name').textContent = currentUser.firstName;
            
            updateDashboardData();
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('user-name').textContent = 'Account';
            document.getElementById('logged-out-menu').style.display = 'block';
            document.getElementById('logged-in-menu').style.display = 'none';
            
            // Hide dashboard
            document.getElementById('login-required').style.display = 'block';
            document.getElementById('user-dashboard').style.display = 'none';
        }

        function updateDashboardData() {
            if (!currentUser) return;
            
            const donations = getUserDonations();
            const totalDonated = donations.reduce((sum, donation) => sum + donation.amount, 0);
            const totalTaxSavings = donations.reduce((sum, donation) => sum + donation.taxSavings, 0);
            const uniqueNGOs = new Set(donations.map(d => d.ngo)).size;
            
            document.getElementById('total-donated').textContent = `R${totalDonated.toLocaleString()}`;
            document.getElementById('total-tax-savings').textContent = `R${totalTaxSavings.toLocaleString()}`;
            document.getElementById('ngos-supported').textContent = uniqueNGOs;
            document.getElementById('total-certificates').textContent = donations.length;
            
            document.getElementById('summary-total').textContent = `R${totalDonated.toLocaleString()}`;
            document.getElementById('summary-savings').textContent = `R${totalTaxSavings.toLocaleString()}`;
            document.getElementById('summary-cost').textContent = `R${(totalDonated - totalTaxSavings).toLocaleString()}`;
            
            renderDonationHistory(donations);
        }

        function renderDonationHistory(donations) {
            const container = document.getElementById('donations-table');
            
            if (donations.length === 0) {
                container.innerHTML = `
                    <div class="no-donations">
                        <i class="fas fa-heart"></i>
                        <p>No donations yet. <a href="#" onclick="showPage('donate')">Make your first donation</a> to start saving on taxes!</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <div class="history-table">
                    <div class="table-header">
                        <span>Date</span>
                        <span>NGO</span>
                        <span>Amount</span>
                        <span>Tax Saved</span>
                        <span>Certificate</span>
                    </div>
            `;
            
            donations.slice(-10).reverse().forEach((donation, index) => {
                tableHTML += `
                    <div class="table-row">
                        <span>${new Date(donation.date).toLocaleDateString()}</span>
                        <span>${donation.ngo}</span>
                        <span>R${donation.amount.toLocaleString()}</span>
                        <span>R${donation.taxSavings.toLocaleString()}</span>
                        <span><button class="download-btn" onclick="downloadCertificate('${donation.id}')">
                            <i class="fas fa-download"></i> Download
                        </button></span>
                    </div>
                `;
            });
            
            tableHTML += '</div>';
            container.innerHTML = tableHTML;
        }

        // Donation Processing
        async function processDonation(ngoName, amount, frequency) {
            if (!currentUser) {
                alert('Please login to make a donation.');
                showAuthModal('login');
                return;
            }
            
            const taxRate = calculateTaxRate(currentUser.annualIncome);
            const taxSavings = amount * taxRate;
            
            const donation = {
                id: 'CERT' + Date.now(),
                ngo: ngoName,
                amount: amount,
                taxSavings: taxSavings,
                frequency: frequency,
                date: new Date().toISOString(),
                certificateDownloaded: false
            };
            
            const donations = getUserDonations();
            donations.push(donation);
            await saveUserDonations(donations);
            
            // Update user totals
            currentUser.totalDonated += amount;
            currentUser.totalTaxSavings += taxSavings;
            
            const allData = await getAllUsers();
            allData.users[currentUser.email] = currentUser;
            await saveAllUsers(allData);
            saveUser(currentUser);
            
            updateDashboardData();
            
            return donation;
        }

        function calculateTaxRate(incomeRange) {
            switch(incomeRange) {
                case '0-200000': return 0.18;
                case '200000-500000': return 0.26;
                case '500000-1000000': return 0.31;
                case '1000000+': return 0.41;
                default: return 0.31;
            }
        }

        // Navigation functionality
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            const navLink = document.querySelector(`[href="#${pageId}"]`);
            if (navLink) navLink.classList.add('active');
        }

        // NGO filtering
        function filterNGOs(category) {
            const ngoItems = document.querySelectorAll('.ngo-item');
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            // Update active filter button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // Show/hide NGO items
            ngoItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Select NGO for donation
        function selectNGO(ngoName, category) {
            if (!currentUser) {
                alert('Please login to make a donation.');
                window.location.href = 'login.html';
                return;
            }
            selectedNGO = ngoName;
            selectedCategory = category;
            document.getElementById('selected-ngo').textContent = ngoName;
            showPage('donate');
        }

        // Tax calculation for South Africa
        function calculateSavings() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const donation = parseFloat(document.getElementById('donation').value) || 0;
            
            // South African tax brackets for 2024/2025 tax year
            let taxRate = 0;
            if (income <= 237100) taxRate = 0.18;
            else if (income <= 370500) taxRate = 0.26;
            else if (income <= 512800) taxRate = 0.31;
            else if (income <= 673000) taxRate = 0.36;
            else if (income <= 857900) taxRate = 0.39;
            else if (income <= 1817000) taxRate = 0.41;
            else taxRate = 0.45;
            
            // Section 18A deduction limits: 10% of taxable income, max R100,000
            const maxDeduction = Math.min(income * 0.10, 100000);
            const actualDeduction = Math.min(donation, maxDeduction);
            const taxSavings = actualDeduction * taxRate;
            const netCost = donation - taxSavings;
            
            // Format South African Rand
            const formatter = new Intl.NumberFormat('en-ZA', {
                style: 'currency',
                currency: 'ZAR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
            
            document.getElementById('tax-bracket').textContent = `${(taxRate * 100).toFixed(0)}%`;
            document.getElementById('max-deductible').textContent = formatter.format(maxDeduction);
            document.getElementById('tax-savings').textContent = formatter.format(taxSavings);
            document.getElementById('net-cost').textContent = formatter.format(netCost);
            
            // Warning if donation exceeds deductible limit
            if (donation > maxDeduction) {
                document.getElementById('max-deductible').style.color = '#f56565';
            } else {
                document.getElementById('max-deductible').style.color = '#48bb78';
            }
        }

        // Update donation preview
        function updateDonationPreview() {
            const amount = parseFloat(document.getElementById('donation-amount').value) || 0;
            let taxRate = 0.31; // Default rate
            if (currentUser) {
                taxRate = calculateTaxRate(currentUser.annualIncome);
            }
            const taxSavings = amount * taxRate;
            const netCost = amount - taxSavings;
            
            document.getElementById('preview-amount').textContent = `R${amount.toLocaleString()}`;
            document.getElementById('preview-savings').textContent = `R${taxSavings.toLocaleString()}`;
            document.getElementById('preview-net').textContent = `R${netCost.toLocaleString()}`;
        }

        // Download SARS certificate
        async function downloadCertificate(certId) {
            const donations = getUserDonations();
            const donation = donations.find(d => d.id === certId);
            
            if (!donation) {
                alert('Certificate not found.');
                return;
            }
            
            // Mark as downloaded
            donation.certificateDownloaded = true;
            await saveUserDonations(donations);
            
            alert(`Downloading Section 18A certificate ${certId}...\\n\\nThis certificate is SARS-compliant and ready for eFiling submission.`);
            
            // Simulate download
            const certificateContent = `SECTION 18A TAX CERTIFICATE\\n\\nCertificate ID: ${certId}\\nDonor: ${currentUser.firstName} ${currentUser.lastName}\\nEmail: ${currentUser.email}\\nNGO: ${donation.ngo}\\nAmount: R${donation.amount.toLocaleString()}\\nTax Savings: R${donation.taxSavings.toLocaleString()}\\nDate: ${new Date(donation.date).toLocaleDateString()}\\n\\nThis certificate is valid for SARS tax deduction purposes under Section 18A of the Income Tax Act.`;
            
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(certificateContent);
            link.download = `SARS_Certificate_${certId}.txt`;
            link.click();
        }

        // Download annual summary
        function downloadAnnualSummary() {
            if (!currentUser) {
                alert('Please login to download your annual summary.');
                return;
            }
            
            const donations = getUserDonations();
            const currentYear = new Date().getFullYear();
            const yearDonations = donations.filter(d => new Date(d.date).getFullYear() === currentYear);
            
            alert('Downloading your 2025 Annual Donation Summary...\\n\\nThis comprehensive report includes all donations, tax savings, and SARS documentation for easy tax filing.');
            
            let summaryContent = `${currentYear} ANNUAL DONATION SUMMARY\\n\\n`;
            summaryContent += `Donor: ${currentUser.firstName} ${currentUser.lastName}\\n`;
            summaryContent += `Email: ${currentUser.email}\\n`;
            summaryContent += `ID Number: ${currentUser.idNumber}\\n\\n`;
            
            const totalDonated = yearDonations.reduce((sum, d) => sum + d.amount, 0);
            const totalTaxSavings = yearDonations.reduce((sum, d) => sum + d.taxSavings, 0);
            
            summaryContent += `SUMMARY:\\n`;
            summaryContent += `Total Donations: R${totalDonated.toLocaleString()}\\n`;
            summaryContent += `Total Tax Savings: R${totalTaxSavings.toLocaleString()}\\n`;
            summaryContent += `Net Cost: R${(totalDonated - totalTaxSavings).toLocaleString()}\\n\\n`;
            
            summaryContent += `DETAILED BREAKDOWN:\\n`;
            yearDonations.forEach((donation, index) => {
                summaryContent += `${index + 1}. ${new Date(donation.date).toLocaleDateString()} - ${donation.ngo} - R${donation.amount.toLocaleString()} (Tax Saved: R${donation.taxSavings.toLocaleString()})\\n`;
            });
            
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(summaryContent);
            link.download = `${currentYear}_Annual_Donation_Summary.txt`;
            link.click();
        }

        // Data Statistics
        async function showDataStats() {
            if (!currentUser) {
                alert('Please login to view statistics.');
                return;
            }
            
            const allData = await getAllUsers();
            const userDonations = getUserDonations();
            const totalUsers = Object.keys(allData.users).length;
            const totalDonations = Object.values(allData.donations).flat().length;
            const userRank = Object.values(allData.users)
                .sort((a, b) => b.totalDonated - a.totalDonated)
                .findIndex(user => user.email === currentUser.email) + 1;
            
            const stats = `PLATFORM STATISTICS\\n\\n` +
                `Total Registered Users: ${totalUsers}\\n` +
                `Total Donations Made: ${totalDonations}\\n` +
                `Your Donation Rank: #${userRank} of ${totalUsers}\\n\\n` +
                `YOUR PERSONAL STATS:\\n` +
                `Registration Date: ${new Date(currentUser.registrationDate).toLocaleDateString()}\\n` +
                `Total Donations: ${userDonations.length}\\n` +
                `Total Amount Donated: R${currentUser.totalDonated.toLocaleString()}\\n` +
                `Total Tax Savings: R${currentUser.totalTaxSavings.toLocaleString()}\\n` +
                `Average Donation: R${userDonations.length > 0 ? (currentUser.totalDonated / userDonations.length).toLocaleString() : '0'}`;
            
            alert(stats);
        }

        // Debug functions (can be called from browser console)
        function testLogin() {
            console.log('Testing login function...');
            const testEvent = { preventDefault: () => console.log('preventDefault called') };
            login(testEvent);
        }

        function testRegister() {
            console.log('Testing register function...');
            const testEvent = { preventDefault: () => console.log('preventDefault called') };
            register(testEvent);
        }

        function debugAuth() {
            console.log('Current user:', currentUser);
            console.log('Auth modal exists:', document.getElementById('auth-modal') ? 'Yes' : 'No');
            console.log('Login form exists:', document.getElementById('login-form-element') ? 'Yes' : 'No');
            console.log('Register form exists:', document.getElementById('register-form-element') ? 'Yes' : 'No');
        }

        // Tab switching for application forms
        function switchApplyTab(tabName) {
            // Hide all content
            document.querySelectorAll('.apply-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected content
            document.getElementById(`${tabName}-application`).classList.add('active');
            
            // Update tab buttons
            document.querySelectorAll('.apply-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize data from JSON file
            try {
                const data = await loadUserData();
                if (data && Object.keys(data.users).length > 0) {
                    // Data loaded successfully from JSON file
                    console.log('User data loaded from users.json');
                    localStorage.setItem('ngo_platform_data', JSON.stringify(data));
                }
            } catch (error) {
                console.log('Using localStorage data or creating new data structure');
            }

            // Check if user is already logged in
            currentUser = getUser();
            if (currentUser) {
                updateUIForLoggedInUser();
            }

            // Handle URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const page = urlParams.get('page');
            const loginSuccess = urlParams.get('login');
            const registerSuccess = urlParams.get('register');
            
            // Show success messages and redirect to dashboard
            if (loginSuccess === 'success' || registerSuccess === 'success') {
                if (currentUser) {
                    showPage('dashboard');
                    if (registerSuccess === 'success') {
                        setTimeout(() => {
                            alert(`Welcome to the platform, ${currentUser.firstName}! 🎉\\n\\nYour account is now active and ready to use. You can start making donations and saving on taxes immediately.`);
                        }, 500);
                    } else {
                        setTimeout(() => {
                            alert(`Welcome back, ${currentUser.firstName}! 👋\\n\\nYour dashboard is now active with all your donation history and tax certificates.`);
                        }, 500);
                    }
                    // Clean up URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            } else if (page === 'dashboard' && currentUser) {
                showPage('dashboard');
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }

            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('href').substring(1);
                    if (pageId && pageId !== '#') {
                        showPage(pageId);
                    }
                });
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    filterNGOs(btn.dataset.category);
                });
            });

            // Apply tab buttons
            document.querySelectorAll('.apply-tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchApplyTab(btn.dataset.tab);
                });
            });

            // Donation amount preview
            const donationAmountInput = document.getElementById('donation-amount');
            if (donationAmountInput) {
                donationAmountInput.addEventListener('input', updateDonationPreview);
                updateDonationPreview(); // Initialize
            }

            // Form submissions
            const donationForm = document.getElementById('donation-form');
            if (donationForm) {
                donationForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (!currentUser) {
                        alert('Please login to make a donation.');
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    const amount = parseFloat(document.getElementById('donation-amount').value);
                    const frequency = document.getElementById('donation-frequency').value;
                    
                    const donation = processDonation(selectedNGO, amount, frequency);
                    if (donation) {
                        alert(`Thank you for your donation to ${selectedNGO}!\\n\\nAmount: R${amount.toLocaleString()}\\nTax Savings: R${donation.taxSavings.toLocaleString()}\\n\\nYour Section 18A certificate is ready for download in your dashboard.`);
                        showPage('dashboard');
                    }
                });
            }

            // Authentication form submissions
            const loginFormElement = document.getElementById('login-form-element');
            if (loginFormElement) {
                loginFormElement.addEventListener('submit', login);
            }

            const registerFormElement = document.getElementById('register-form-element');
            if (registerFormElement) {
                registerFormElement.addEventListener('submit', register);
            }

            // NGO Application Form
            const ngoForm = document.getElementById('ngo-application-form');
            if (ngoForm) {
                ngoForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    alert('Thank you for your NGO application!\\n\\nYour application has been submitted and will be reviewed by our verification team within 5-7 business days.\\n\\nYou will receive an email confirmation and updates on the verification process.');
                });
            }

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                const modal = document.getElementById('auth-modal');
                if (e.target === modal) {
                    closeAuthModal();
                }
            });

            // Initialize calculator if on home page
            if (document.getElementById('income')) {
                document.getElementById('income').value = '500000';
                document.getElementById('donation').value = '10000';
                calculateSavings();
            }
        });
    </script>
</body>
</html>